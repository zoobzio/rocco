---
title: API Reference
description: Complete API documentation for rocco
author: zoobzio
published: 2025-12-16
updated: 2025-12-16
tags:
  - Reference
  - API
---

# API Reference

Complete reference for all rocco types and functions.

## Engine

### NewEngine

```go
func NewEngine(host string, port int, extractIdentity func(context.Context, *http.Request) (Identity, error)) *Engine
```

Creates a new Engine instance.

| Parameter | Type | Description |
|-----------|------|-------------|
| `host` | `string` | Host to bind to (e.g., "localhost", "0.0.0.0") |
| `port` | `int` | Port to listen on |
| `extractIdentity` | `func(context.Context, *http.Request) (Identity, error)` | Identity extractor for authentication (nil for no auth) |

### Engine Methods

#### WithMiddleware

```go
func (e *Engine) WithMiddleware(middleware ...func(http.Handler) http.Handler) *Engine
```

Adds global middleware. Returns engine for chaining.

#### WithHandlers

```go
func (e *Engine) WithHandlers(handlers ...Endpoint) *Engine
```

Registers handlers with the engine. Returns engine for chaining.

#### WithSpec

```go
func (e *Engine) WithSpec(spec *EngineSpec) *Engine
```

Sets the OpenAPI specification configuration.

#### WithOpenAPIInfo

```go
func (e *Engine) WithOpenAPIInfo(info openapi.Info) *Engine
```

Sets OpenAPI Info metadata (title, version, description, etc.).

#### WithTag

```go
func (e *Engine) WithTag(name, description string) *Engine
```

Adds or updates an OpenAPI tag with description.

#### Router

```go
func (e *Engine) Router() *http.ServeMux
```

Returns the underlying stdlib ServeMux for advanced use cases.

#### GenerateOpenAPI

```go
func (e *Engine) GenerateOpenAPI(identity Identity) *openapi.OpenAPI
```

Generates OpenAPI specification. Pass an Identity to filter handlers by permissions, or nil for all handlers.

#### Start

```go
func (e *Engine) Start() error
```

Starts the HTTP server. Blocks until shutdown.

#### Shutdown

```go
func (e *Engine) Shutdown(ctx context.Context) error
```

Gracefully shuts down the server, waiting for active requests.

## Handler

### NewHandler

```go
func NewHandler[In, Out any](name string, method, path string, fn func(*Request[In]) (Out, error)) *Handler[In, Out]
```

Creates a new typed handler.

| Parameter | Type | Description |
|-----------|------|-------------|
| `name` | `string` | Handler name for logging and documentation |
| `method` | `string` | HTTP method (GET, POST, PUT, PATCH, DELETE) |
| `path` | `string` | URL path with optional parameters (e.g., "/users/{id}") |
| `fn` | `func(*Request[In]) (Out, error)` | Handler function |

### Handler Methods

#### WithSummary

```go
func (h *Handler[In, Out]) WithSummary(summary string) *Handler[In, Out]
```

Sets OpenAPI summary (short description).

#### WithDescription

```go
func (h *Handler[In, Out]) WithDescription(desc string) *Handler[In, Out]
```

Sets OpenAPI description (detailed, supports markdown).

#### WithTags

```go
func (h *Handler[In, Out]) WithTags(tags ...string) *Handler[In, Out]
```

Sets OpenAPI tags for grouping operations.

#### WithSuccessStatus

```go
func (h *Handler[In, Out]) WithSuccessStatus(status int) *Handler[In, Out]
```

Sets HTTP status code for successful responses. Default: 200.

#### WithPathParams

```go
func (h *Handler[In, Out]) WithPathParams(params ...string) *Handler[In, Out]
```

Declares required path parameters.

#### WithQueryParams

```go
func (h *Handler[In, Out]) WithQueryParams(params ...string) *Handler[In, Out]
```

Declares query parameters.

#### WithResponseHeaders

```go
func (h *Handler[In, Out]) WithResponseHeaders(headers map[string]string) *Handler[In, Out]
```

Sets default response headers.

#### WithErrors

```go
func (h *Handler[In, Out]) WithErrors(errs ...ErrorDefinition) *Handler[In, Out]
```

Declares errors this handler may return.

#### WithMaxBodySize

```go
func (h *Handler[In, Out]) WithMaxBodySize(size int64) *Handler[In, Out]
```

Sets maximum request body size in bytes. Default: 10MB.

#### WithOutputValidation

```go
func (h *Handler[In, Out]) WithOutputValidation() *Handler[In, Out]
```

Enables output validation. Disabled by default.

#### WithMiddleware

```go
func (h *Handler[In, Out]) WithMiddleware(middleware ...func(http.Handler) http.Handler) *Handler[In, Out]
```

Adds handler-specific middleware.

#### WithAuthentication

```go
func (h *Handler[In, Out]) WithAuthentication() *Handler[In, Out]
```

Marks handler as requiring authentication.

#### WithScopes

```go
func (h *Handler[In, Out]) WithScopes(scopes ...string) *Handler[In, Out]
```

Requires one of the specified scopes (OR logic). Multiple calls create AND logic.

#### WithRoles

```go
func (h *Handler[In, Out]) WithRoles(roles ...string) *Handler[In, Out]
```

Requires one of the specified roles (OR logic). Multiple calls create AND logic.

#### WithUsageLimit

```go
func (h *Handler[In, Out]) WithUsageLimit(key string, thresholdFunc func(Identity) int) *Handler[In, Out]
```

Adds usage limit check based on identity stats.

## StreamHandler

### NewStreamHandler

```go
func NewStreamHandler[In, Out any](name string, method, path string, fn func(*Request[In], Stream[Out]) error) *StreamHandler[In, Out]
```

Creates a new typed streaming handler for Server-Sent Events.

| Parameter | Type | Description |
|-----------|------|-------------|
| `name` | `string` | Handler name for logging and documentation |
| `method` | `string` | HTTP method (typically GET or POST) |
| `path` | `string` | URL path with optional parameters |
| `fn` | `func(*Request[In], Stream[Out]) error` | Stream handler function |

### StreamHandler Methods

StreamHandler supports the same builder methods as Handler:

- `WithSummary(summary string)` - Sets OpenAPI summary
- `WithDescription(desc string)` - Sets OpenAPI description
- `WithTags(tags ...string)` - Sets OpenAPI tags
- `WithPathParams(params ...string)` - Declares path parameters
- `WithQueryParams(params ...string)` - Declares query parameters
- `WithErrors(errs ...ErrorDefinition)` - Declares possible errors
- `WithMiddleware(middleware ...func(http.Handler) http.Handler)` - Adds middleware
- `WithAuthentication()` - Requires authentication
- `WithScopes(scopes ...string)` - Requires scopes
- `WithRoles(roles ...string)` - Requires roles

## Stream

```go
type Stream[T any] interface {
    Send(data T) error
    SendEvent(event string, data T) error
    SendComment(comment string) error
    Done() <-chan struct{}
}
```

Interface for sending SSE events.

### Send

```go
func (s Stream[T]) Send(data T) error
```

Sends a data-only event. Data is JSON-encoded.

### SendEvent

```go
func (s Stream[T]) SendEvent(event string, data T) error
```

Sends a named event with data. Allows client-side event filtering.

### SendComment

```go
func (s Stream[T]) SendComment(comment string) error
```

Sends a comment (prefixed with `:`). Useful for keep-alive.

### Done

```go
func (s Stream[T]) Done() <-chan struct{}
```

Returns a channel closed when the client disconnects. Use in select statements to detect disconnection.

## Request

```go
type Request[In any] struct {
    context.Context // Embedded for deadline, cancellation, values
    *http.Request   // Embedded for direct access when needed
    Params          *Params
    Body            In
    Identity        Identity
}
```

| Field | Type | Description |
|-------|------|-------------|
| `context.Context` | embedded | Request context (deadline, cancellation, values) |
| `*http.Request` | embedded | Underlying HTTP request (use sparingly) |
| `Params` | `*Params` | Path and query parameters |
| `Body` | `In` | Parsed and validated request body |
| `Identity` | `Identity` | Authenticated identity (or NoIdentity) |

## Params

```go
type Params struct {
    Path  map[string]string
    Query map[string]string
}
```

| Field | Type | Description |
|-------|------|-------------|
| `Path` | `map[string]string` | Path parameters (e.g., `{id}`) |
| `Query` | `map[string]string` | Query parameters |

## NoBody

```go
type NoBody struct{}
```

Empty struct for handlers without request bodies.

## Identity

```go
type Identity interface {
    ID() string
    TenantID() string
    HasScope(scope string) bool
    HasRole(role string) bool
    Stats() map[string]int
}
```

| Method | Return | Description |
|--------|--------|-------------|
| `ID()` | `string` | Unique identifier |
| `TenantID()` | `string` | Tenant/organization ID |
| `HasScope(scope)` | `bool` | Check if identity has scope |
| `HasRole(role)` | `bool` | Check if identity has role |
| `Stats()` | `map[string]int` | Usage statistics for rate limiting |

## NoIdentity

```go
type NoIdentity struct{}
```

Default identity for unauthenticated requests. All methods return empty/false values.

## EngineConfig

```go
type EngineConfig struct {
    Host         string
    Port         int
    ReadTimeout  time.Duration
    WriteTimeout time.Duration
    IdleTimeout  time.Duration
}
```

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `Host` | `string` | - | Bind host |
| `Port` | `int` | - | Listen port |
| `ReadTimeout` | `time.Duration` | 120s | Read timeout |
| `WriteTimeout` | `time.Duration` | 120s | Write timeout |
| `IdleTimeout` | `time.Duration` | 120s | Idle timeout |

## EngineSpec

```go
type EngineSpec struct {
    Info openapi.Info
    Tags []openapi.Tag
}
```

OpenAPI specification configuration.

## HandlerSpec

```go
type HandlerSpec struct {
    Name           string
    Method         string
    Path           string
    Summary        string
    Description    string
    Tags           []string
    PathParams     []string
    QueryParams    []string
    InputTypeName  string
    OutputTypeName string
    SuccessStatus  int
    ErrorCodes     []int
    RequiresAuth   bool
    ScopeGroups    [][]string
    RoleGroups     [][]string
    UsageLimits    []UsageLimit
}
```

Handler metadata for OpenAPI generation.

## UsageLimit

```go
type UsageLimit struct {
    Key           string
    ThresholdFunc func(Identity) int
}
```

Usage limit configuration for rate limiting.

## Endpoint

```go
type Endpoint interface {
    Process(ctx context.Context, r *http.Request, w http.ResponseWriter) (int, error)
    Spec() HandlerSpec
    ErrorDefs() []ErrorDefinition
    Middleware() []func(http.Handler) http.Handler
    Close() error
}
```

Interface implemented by Handler.

| Method | Description |
|--------|-------------|
| `Process(...)` | Handles the HTTP request and writes the response |
| `Spec()` | Returns the declarative specification for this handler |
| `ErrorDefs()` | Returns declared error definitions for OpenAPI generation |
| `Middleware()` | Returns handler-specific middleware |
| `Close()` | Lifecycle cleanup |

## See Also

- [Errors Reference](2.errors.md) - Error types
- [Events Reference](3.events.md) - Event signals
- [Core Concepts](../2.learn/2.concepts.md) - Usage overview
