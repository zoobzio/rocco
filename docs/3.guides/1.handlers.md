---
title: Handlers
description: Deep dive into handler configuration and patterns
author: zoobzio
published: 2025-12-16
updated: 2025-12-16
tags:
  - Handlers
  - Configuration
  - Patterns
---

# Handlers Guide

Handlers are the core building block of rocco APIs. This guide covers advanced handler configuration, body parsing, parameters, and common patterns.

## Handler Anatomy

A handler consists of four parts:

```go
handler := rocco.NewHandler[InputType, OutputType](
    "handler-name",  // 1. Name - for logging and documentation
    "POST",          // 2. Method - HTTP method
    "/path/{id}",    // 3. Path - URL path with optional params
    handlerFunc,     // 4. Function - request processor
)
```

The generic types `[InputType, OutputType]` define the request body and response types. Use `rocco.NoBody` for handlers without request bodies.

## Handler Configuration Methods

### Documentation

```go
handler.
    WithSummary("Create a user").           // Short summary for OpenAPI
    WithDescription("Long description..."). // Detailed description
    WithTags("users", "admin")              // OpenAPI tags for grouping
```

### Status Codes

```go
handler.WithSuccessStatus(201) // Override default 200 OK

// Common status codes:
// 200 OK - Default for most operations
// 201 Created - Resource creation
// 204 No Content - Successful with no body
```

### Parameters

```go
handler.
    WithPathParams("id", "subId").        // Required path parameters
    WithQueryParams("page", "limit")      // Optional query parameters
```

### Error Declaration

```go
handler.WithErrors(
    rocco.ErrNotFound,
    rocco.ErrConflict,
    rocco.ErrUnprocessableEntity,
)
```

### Body Limits

```go
handler.WithMaxBodySize(1 * 1024 * 1024) // 1MB limit (default: 10MB)
handler.WithMaxBodySize(0)               // Unlimited (not recommended)
```

### Validation

```go
handler.WithOutputValidation() // Enable output validation (disabled by default)
```

### Response Headers

```go
handler.WithResponseHeaders(map[string]string{
    "X-Custom-Header": "value",
    "Cache-Control":   "no-cache",
})
```

## Path Parameters

Path parameters use Chi's syntax with curly braces:

```go
// Single parameter
handler := rocco.NewHandler[rocco.NoBody, User](
    "get-user",
    "GET",
    "/users/{id}",
    func(req *rocco.Request[rocco.NoBody]) (User, error) {
        id := req.Params.Path["id"] // "123"
        return getUser(id)
    },
).WithPathParams("id")

// Multiple parameters
handler := rocco.NewHandler[rocco.NoBody, Comment](
    "get-comment",
    "GET",
    "/posts/{postId}/comments/{commentId}",
    func(req *rocco.Request[rocco.NoBody]) (Comment, error) {
        postID := req.Params.Path["postId"]
        commentID := req.Params.Path["commentId"]
        return getComment(postID, commentID)
    },
).WithPathParams("postId", "commentId")
```

**Important**: Always declare path parameters with `WithPathParams()`. Undeclared parameters won't cause errors but won't appear in OpenAPI documentation.

## Query Parameters

Query parameters are optional and accessed via `req.Params.Query`:

```go
handler := rocco.NewHandler[rocco.NoBody, UserList](
    "list-users",
    "GET",
    "/users",
    func(req *rocco.Request[rocco.NoBody]) (UserList, error) {
        // Get query params (empty string if not provided)
        page := req.Params.Query["page"]
        limit := req.Params.Query["limit"]
        filter := req.Params.Query["filter"]

        // Parse with defaults
        pageNum := 1
        if page != "" {
            pageNum, _ = strconv.Atoi(page)
        }

        return listUsers(pageNum, filter)
    },
).WithQueryParams("page", "limit", "filter")
```

Query parameters must be declared with `WithQueryParams()` to appear in OpenAPI documentation.

## Request Body Handling

### Typed Bodies

For POST, PUT, PATCH requests, define a typed input struct:

```go
type CreateOrderInput struct {
    CustomerID string       `json:"customer_id" validate:"required,uuid"`
    Items      []OrderItem  `json:"items" validate:"required,min=1,dive"`
    Notes      string       `json:"notes" validate:"max=500"`
}

handler := rocco.NewHandler[CreateOrderInput, Order](
    "create-order",
    "POST",
    "/orders",
    func(req *rocco.Request[CreateOrderInput]) (Order, error) {
        // req.Body is CreateOrderInput (validated)
        return createOrder(req.Body.CustomerID, req.Body.Items)
    },
)
```

### Empty Bodies

For GET, DELETE, or other bodyless requests:

```go
handler := rocco.NewHandler[rocco.NoBody, DeleteResult](
    "delete-user",
    "DELETE",
    "/users/{id}",
    func(req *rocco.Request[rocco.NoBody]) (DeleteResult, error) {
        return deleteUser(req.Params.Path["id"])
    },
)
```

### Large Bodies

For file uploads or large payloads, increase the body limit:

```go
handler := rocco.NewHandler[UploadInput, UploadResult](
    "upload-file",
    "POST",
    "/upload",
    handleUpload,
).WithMaxBodySize(100 * 1024 * 1024) // 100MB
```

## Handler Middleware

Add middleware to specific handlers:

```go
handler := rocco.NewHandler[Input, Output](
    "protected-action",
    "POST",
    "/action",
    handleAction,
).WithMiddleware(
    rateLimiter,
    auditLogger,
)
```

Middleware executes in order: first added runs first.

## Handler Patterns

### Resource Handler Pattern

Group related handlers by resource:

```go
func UserHandlers() []rocco.Endpoint {
    return []rocco.Endpoint{
        rocco.NewHandler[rocco.NoBody, UserList](
            "list-users", "GET", "/users", listUsers,
        ).WithQueryParams("page", "limit"),

        rocco.NewHandler[CreateUserInput, User](
            "create-user", "POST", "/users", createUser,
        ).WithSuccessStatus(201),

        rocco.NewHandler[rocco.NoBody, User](
            "get-user", "GET", "/users/{id}", getUser,
        ).WithPathParams("id").WithErrors(rocco.ErrNotFound),

        rocco.NewHandler[UpdateUserInput, User](
            "update-user", "PUT", "/users/{id}", updateUser,
        ).WithPathParams("id").WithErrors(rocco.ErrNotFound),

        rocco.NewHandler[rocco.NoBody, DeleteResult](
            "delete-user", "DELETE", "/users/{id}", deleteUser,
        ).WithPathParams("id").WithErrors(rocco.ErrNotFound),
    }
}

// Register all at once
engine.WithHandlers(UserHandlers()...)
```

### Versioned APIs

```go
// v1 handlers
v1Create := rocco.NewHandler[V1CreateInput, V1Output](
    "v1-create", "POST", "/v1/resources", handleV1Create,
).WithTags("v1")

// v2 handlers with different schema
v2Create := rocco.NewHandler[V2CreateInput, V2Output](
    "v2-create", "POST", "/v2/resources", handleV2Create,
).WithTags("v2")
```

### Conditional Logic

```go
handler := rocco.NewHandler[Input, Output](
    "conditional",
    "GET",
    "/resource/{id}",
    func(req *rocco.Request[Input]) (Output, error) {
        format := req.Params.Query["format"]

        switch format {
        case "detailed":
            return getDetailedResource(req.Params.Path["id"])
        case "summary":
            return getSummaryResource(req.Params.Path["id"])
        default:
            return getResource(req.Params.Path["id"])
        }
    },
).WithQueryParams("format")
```

## Common Mistakes

### Forgetting Parameter Declaration

```go
// WRONG - param won't appear in OpenAPI
handler := rocco.NewHandler[rocco.NoBody, User](
    "get-user", "GET", "/users/{id}", getUser,
)

// CORRECT
handler := rocco.NewHandler[rocco.NoBody, User](
    "get-user", "GET", "/users/{id}", getUser,
).WithPathParams("id")
```

### Undeclared Errors

```go
// WRONG - returns 500 instead of 404
handler := rocco.NewHandler[rocco.NoBody, User](
    "get-user", "GET", "/users/{id}",
    func(req *rocco.Request[rocco.NoBody]) (User, error) {
        return User{}, rocco.ErrNotFound // Undeclared!
    },
)

// CORRECT
handler := rocco.NewHandler[rocco.NoBody, User](
    "get-user", "GET", "/users/{id}",
    func(req *rocco.Request[rocco.NoBody]) (User, error) {
        return User{}, rocco.ErrNotFound
    },
).WithErrors(rocco.ErrNotFound)
```

### Wrong NoBody Usage

```go
// WRONG - NoBody for POST with body
handler := rocco.NewHandler[rocco.NoBody, User](
    "create-user", "POST", "/users", createUser,
)

// CORRECT - use typed input
handler := rocco.NewHandler[CreateUserInput, User](
    "create-user", "POST", "/users", createUser,
)
```

## See Also

- [Error Handling](2.errors.md) - Error patterns and custom errors
- [Authentication](3.authentication.md) - Identity and authorization
- [API Reference](../5.reference/1.api.md) - Complete API documentation
