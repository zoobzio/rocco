---
title: OpenAPI Generation
description: Schema generation, tags, and validation mapping
author: zoobzio
published: 2025-12-16
updated: 2025-12-16
tags:
  - OpenAPI
  - Documentation
  - Schemas
---

# OpenAPI Generation Guide

Rocco automatically generates OpenAPI 3.0.3 specifications from your handlers. This guide covers customization, schema tags, and advanced patterns.

## Default Endpoints

When you register any handler, rocco automatically sets up:

- `/openapi` - OpenAPI JSON specification
- `/docs` - Interactive Scalar documentation

```go
engine := rocco.NewEngine("localhost", 8080, nil)
engine.WithHandlers(handler)
engine.Start()

// Visit http://localhost:8080/docs for interactive docs
```

## Customizing API Info

```go
engine.WithOpenAPIInfo(openapi.Info{
    Title:          "My API",
    Description:    "API for managing resources",
    Version:        "1.0.0",
    TermsOfService: "https://example.com/terms",
    Contact: &openapi.Contact{
        Name:  "API Support",
        URL:   "https://example.com/support",
        Email: "support@example.com",
    },
    License: &openapi.License{
        Name: "MIT",
        URL:  "https://opensource.org/licenses/MIT",
    },
})
```

## Tags

Tags group operations in the documentation:

### Handler Tags

```go
handler := rocco.NewHandler[Input, Output](
    "create-user",
    "POST",
    "/users",
    createUser,
).WithTags("users", "admin")
```

### Engine Tags (with descriptions)

```go
engine.WithTag("users", "User management operations")
engine.WithTag("orders", "Order processing and tracking")
engine.WithTag("admin", "Administrative operations")
```

## Handler Documentation

```go
handler := rocco.NewHandler[CreateUserInput, UserOutput](
    "create-user",
    "POST",
    "/users",
    createUser,
).
    WithSummary("Create a new user").
    WithDescription(`
Creates a new user account with the provided information.

The email must be unique across all users. If a user with the same
email already exists, a 409 Conflict error is returned.

**Required permissions:** users:write
`).
    WithTags("users")
```

## Schema Generation

Rocco generates JSON schemas from your Go types using [sentinel](https://github.com/zoobzio/sentinel).

### Basic Type Mapping

| Go Type | JSON Schema Type |
|---------|------------------|
| `string` | `string` |
| `int`, `int32`, `int64` | `integer` |
| `float32`, `float64` | `number` |
| `bool` | `boolean` |
| `[]T` | `array` |
| `struct` | `object` |
| `*T` | nullable `T` |
| `map[string]T` | `object` with `additionalProperties` |

### Struct Tags

#### JSON Tag

```go
type User struct {
    ID        string `json:"id"`           // Field name in JSON
    FirstName string `json:"first_name"`   // Snake case
    Email     string `json:"email"`
    Internal  string `json:"-"`            // Excluded from schema
}
```

#### Description Tag

```go
type CreateUserInput struct {
    Name  string `json:"name" description:"User's full name"`
    Email string `json:"email" description:"Primary email address"`
    Age   int    `json:"age" description:"Age in years"`
}
```

#### Example Tag

```go
type CreateUserInput struct {
    Name  string `json:"name" example:"John Doe"`
    Email string `json:"email" example:"john@example.com"`
    Age   int    `json:"age" example:"25"`
}
```

Examples are type-aware:
- String: `example:"hello"` → `"hello"`
- Integer: `example:"42"` → `42`
- Float: `example:"3.14"` → `3.14`
- Boolean: `example:"true"` → `true`
- Array: `example:"a,b,c"` → `["a", "b", "c"]`

## Validation to OpenAPI Mapping

The `validate` tag drives both runtime validation and OpenAPI constraints:

| Validator | Applies To | OpenAPI Mapping |
|-----------|------------|-----------------|
| `required` | all | `required` array |
| `min=N` | numbers | `minimum` |
| `max=N` | numbers | `maximum` |
| `min=N` | strings | `minLength` |
| `max=N` | strings | `maxLength` |
| `gte=N` | numbers | `minimum` |
| `lte=N` | numbers | `maximum` |
| `gt=N` | numbers | `minimum` + `exclusiveMinimum` |
| `lt=N` | numbers | `maximum` + `exclusiveMaximum` |
| `len=N` | arrays | `minItems` + `maxItems` |
| `len=N` | strings | `minLength` + `maxLength` |
| `unique` | arrays | `uniqueItems` |
| `email` | strings | `format: "email"` |
| `url` | strings | `format: "uri"` |
| `uuid` | strings | `format: "uuid"` |
| `datetime` | strings | `format: "date-time"` |
| `ipv4` | strings | `format: "ipv4"` |
| `ipv6` | strings | `format: "ipv6"` |
| `oneof=a b c` | any | `enum: ["a", "b", "c"]` |

### Example

```go
type CreateUserInput struct {
    Name     string   `json:"name" validate:"required,min=2,max=100" description:"Full name"`
    Email    string   `json:"email" validate:"required,email" description:"Email address"`
    Age      int      `json:"age" validate:"gte=0,lte=150" description:"Age in years"`
    Role     string   `json:"role" validate:"oneof=admin user guest" description:"User role"`
    Tags     []string `json:"tags" validate:"max=10,unique" description:"User tags"`
}
```

Generated schema:

```yaml
CreateUserInput:
  type: object
  required: [name, email]
  properties:
    name:
      type: string
      minLength: 2
      maxLength: 100
      description: Full name
    email:
      type: string
      format: email
      description: Email address
    age:
      type: integer
      minimum: 0
      maximum: 150
      description: Age in years
    role:
      type: string
      enum: [admin, user, guest]
      description: User role
    tags:
      type: array
      maxItems: 10
      uniqueItems: true
      description: User tags
```

## Error Schemas

Declared errors generate response schemas:

```go
handler.WithErrors(rocco.ErrNotFound, rocco.ErrConflict)
```

Generates:

```yaml
responses:
  404:
    description: Not Found
    content:
      application/json:
        schema:
          $ref: '#/components/schemas/ErrorResponse_NotFoundDetails'
  409:
    description: Conflict
    content:
      application/json:
        schema:
          $ref: '#/components/schemas/ErrorResponse_ConflictDetails'
```

### Custom Error Schemas

```go
type InsufficientFundsDetails struct {
    Required  float64 `json:"required" description:"Amount required"`
    Available float64 `json:"available" description:"Amount available"`
}

var ErrInsufficientFunds = rocco.NewError[InsufficientFundsDetails](
    "INSUFFICIENT_FUNDS", 402, "insufficient funds",
)

handler.WithErrors(ErrInsufficientFunds)
```

The details type generates a schema component.

## Parameters

### Path Parameters

```go
handler := rocco.NewHandler[rocco.NoBody, User](
    "get-user",
    "GET",
    "/users/{id}",
    getUser,
).WithPathParams("id")
```

Generates:

```yaml
parameters:
  - name: id
    in: path
    required: true
    schema:
      type: string
```

### Query Parameters

```go
handler := rocco.NewHandler[rocco.NoBody, UserList](
    "list-users",
    "GET",
    "/users",
    listUsers,
).WithQueryParams("page", "limit", "sort")
```

Generates:

```yaml
parameters:
  - name: page
    in: query
    schema:
      type: string
  - name: limit
    in: query
    schema:
      type: string
  - name: sort
    in: query
    schema:
      type: string
```

## Security Schemes

For authenticated handlers:

```go
handler.WithAuthentication()
handler.WithScopes("users:read")
```

The OpenAPI spec includes security requirements.

## Programmatic Access

Generate the spec programmatically:

```go
spec := engine.GenerateOpenAPI(nil)

// Serialize to JSON
data, _ := json.MarshalIndent(spec, "", "  ")

// Write to file
os.WriteFile("openapi.json", data, 0644)
```

## Best Practices

### 1. Use Descriptive Names

```go
// GOOD - clear handler names
NewHandler[Input, Output]("create-user", ...)
NewHandler[Input, Output]("list-user-orders", ...)

// AVOID - vague names
NewHandler[Input, Output]("handler1", ...)
```

### 2. Document All Fields

```go
type CreateUserInput struct {
    Name  string `json:"name" description:"User's full legal name" example:"John Doe"`
    Email string `json:"email" description:"Primary email for notifications" example:"john@example.com"`
}
```

### 3. Use Consistent Tags

```go
// Group by resource
handler.WithTags("users")
handler.WithTags("orders")

// Add descriptions
engine.WithTag("users", "User management operations")
```

### 4. Validate Everything

```go
type Input struct {
    Email string `json:"email" validate:"required,email"`  // Both validated AND documented
}
```

### 5. Declare All Errors

```go
handler.WithErrors(
    rocco.ErrNotFound,
    rocco.ErrConflict,
    rocco.ErrForbidden,
) // All appear in OpenAPI spec
```

## See Also

- [Handler Guide](1.handlers.md) - Handler configuration
- [Error Handling](2.errors.md) - Error patterns
- [API Reference](../5.reference/1.api.md) - Complete API documentation
