---
title: Core Concepts
description: Understand handlers, requests, responses, and parameters
author: zoobzio
published: 2025-12-16
updated: 2025-12-16
tags:
  - Concepts
  - Handlers
  - Requests
---

# Core Concepts

Rocco is built around a few core primitives: **Engine**, **Handler**, **Request**, and **Response**. Understanding these concepts enables you to build any HTTP API.

## Engine

The Engine is rocco's HTTP server. It manages handler registration, middleware, and request routing.

```go
// Create an engine
engine := rocco.NewEngine("localhost", 8080, extractIdentity)

// Add global middleware
engine.WithMiddleware(loggingMiddleware)

// Register handlers
engine.WithHandlers(handler1, handler2)

// Start serving
engine.Start()
```

| Method | Description |
|--------|-------------|
| `NewEngine(host, port, extractIdentity)` | Create engine with optional identity extraction |
| `WithMiddleware(mw...)` | Add global middleware |
| `WithHandlers(handlers...)` | Register handlers |
| `WithSpec(spec)` | Configure OpenAPI metadata |
| `Router()` | Access underlying stdlib ServeMux |
| `Start()` | Begin serving requests |
| `Shutdown(ctx)` | Graceful shutdown |

## Handler

A Handler is a typed request processor. It declares input/output types and the function that processes requests.

```go
handler := rocco.NewHandler[InputType, OutputType](
    "handler-name",  // Unique name for logging/docs
    "POST",          // HTTP method
    "/path",         // URL path
    func(req *rocco.Request[InputType]) (OutputType, error) {
        // Process request, return response or error
        return OutputType{...}, nil
    },
)
```

### Handler Configuration

Handlers use a builder pattern for configuration:

```go
handler := rocco.NewHandler[CreateOrderInput, OrderOutput](
    "create-order",
    "POST",
    "/orders",
    handleCreateOrder,
).
    WithSummary("Create a new order").              // OpenAPI summary
    WithDescription("Creates an order...").         // OpenAPI description
    WithTags("orders").                             // OpenAPI tags
    WithSuccessStatus(201).                         // Success status code
    WithPathParams("id").                           // Declare path params
    WithQueryParams("include").                     // Declare query params
    WithErrors(ErrNotFound, ErrConflict).           // Declare possible errors
    WithAuthentication().                           // Require authentication
    WithScopes("orders:write").                     // Require scope
    WithRoles("admin", "manager").                  // Require role
    WithMaxBodySize(1024 * 1024).                   // 1MB body limit
    WithMiddleware(customMiddleware)                // Handler-specific middleware
```

### NoBody Type

For handlers without request bodies (GET, DELETE), use `rocco.NoBody`:

```go
handler := rocco.NewHandler[rocco.NoBody, UserOutput](
    "get-user",
    "GET",
    "/users/{id}",
    func(req *rocco.Request[rocco.NoBody]) (UserOutput, error) {
        // req.Body is NoBody (empty struct)
        return UserOutput{...}, nil
    },
)
```

## Request

The Request struct provides access to the parsed body, parameters, identity, and underlying HTTP request.

```go
type Request[T any] struct {
    Context  context.Context    // Request context
    Request  *http.Request      // Underlying HTTP request
    Params   *Params            // Path and query parameters
    Body     T                  // Parsed and validated body
    Identity Identity           // Authenticated identity (if any)
}
```

### Accessing Parameters

```go
func(req *rocco.Request[MyInput]) (MyOutput, error) {
    // Path parameters
    userID := req.Params.Path["id"]

    // Query parameters
    page := req.Params.Query["page"]
    filter := req.Params.Query["filter"]

    // Request body (already parsed and validated)
    name := req.Body.Name

    // Identity (if authenticated)
    if req.Identity != nil {
        tenantID := req.Identity.TenantID()
    }

    // Underlying request
    header := req.Request.Header.Get("X-Custom")

    return MyOutput{...}, nil
}
```

### Parameter Declaration

Handlers must declare their parameters:

```go
// Path parameters use {param} syntax
handler := rocco.NewHandler[rocco.NoBody, Output](
    "get-item",
    "GET",
    "/items/{category}/{id}",
    handleGetItem,
).WithPathParams("category", "id")

// Query parameters
handler := rocco.NewHandler[rocco.NoBody, Output](
    "search",
    "GET",
    "/search",
    handleSearch,
).WithQueryParams("q", "page", "limit", "sort")
```

## Response

Handlers return a typed output value and an error. Rocco handles serialization automatically.

### Success Responses

```go
func(req *rocco.Request[Input]) (Output, error) {
    // Return output - automatically JSON-encoded
    return Output{
        ID:   "123",
        Name: req.Body.Name,
    }, nil
}
```

Default success status is 200 OK. Override with `WithSuccessStatus()`:

```go
handler.WithSuccessStatus(201) // 201 Created
handler.WithSuccessStatus(204) // 204 No Content
```

### Error Responses

Return errors to send error responses:

```go
func(req *rocco.Request[Input]) (Output, error) {
    user, err := db.FindUser(req.Params.Path["id"])
    if err != nil {
        // Sentinel error - returns structured JSON response
        return Output{}, rocco.ErrNotFound.WithMessage("user not found")
    }
    return Output{...}, nil
}
```

Errors must be declared with `WithErrors()`:

```go
handler.WithErrors(rocco.ErrNotFound, rocco.ErrConflict)
```

## Validation

Input validation is automatic using struct tags from `go-playground/validator`:

```go
type CreateUserInput struct {
    Name     string   `json:"name" validate:"required,min=2,max=100"`
    Email    string   `json:"email" validate:"required,email"`
    Age      int      `json:"age" validate:"gte=0,lte=150"`
    Role     string   `json:"role" validate:"oneof=admin user guest"`
    Tags     []string `json:"tags" validate:"max=10,dive,min=1"`
    Website  string   `json:"website" validate:"omitempty,url"`
}
```

| Validator | Description | Example |
|-----------|-------------|---------|
| `required` | Field must be present | `validate:"required"` |
| `min=N` | Minimum length/value | `validate:"min=2"` |
| `max=N` | Maximum length/value | `validate:"max=100"` |
| `email` | Valid email format | `validate:"email"` |
| `url` | Valid URL format | `validate:"url"` |
| `oneof=a b c` | Must be one of values | `validate:"oneof=a b c"` |
| `gte=N` | Greater than or equal | `validate:"gte=0"` |
| `lte=N` | Less than or equal | `validate:"lte=100"` |
| `dive` | Validate slice elements | `validate:"dive,min=1"` |
| `omitempty` | Skip if empty | `validate:"omitempty,url"` |

Invalid inputs return 422 Unprocessable Entity with detailed field errors.

## Identity

Identity represents an authenticated user or service. Implement the `Identity` interface:

```go
type Identity interface {
    ID() string              // Unique identifier
    TenantID() string        // Tenant/organization ID
    Scopes() []string        // Permission scopes
    Roles() []string         // User roles
    Stats() map[string]int   // Usage statistics
    HasScope(string) bool    // Check scope
    HasRole(string) bool     // Check role
}
```

Extract identity in the engine constructor:

```go
engine := rocco.NewEngine("localhost", 8080, func(ctx context.Context, r *http.Request) (rocco.Identity, error) {
    token := r.Header.Get("Authorization")
    // Validate token, return identity or error
    return &MyIdentity{...}, nil
})
```

## Next Steps

- [Architecture](3.architecture.md) - How rocco processes requests internally
- [Handler Guide](../3.guides/1.handlers.md) - Advanced handler patterns
- [Error Handling](../3.guides/2.errors.md) - Error patterns and custom errors

## See Also

- [Authentication Guide](../3.guides/3.authentication.md) - Identity and authorization
- [API Reference](../5.reference/1.api.md) - Complete API documentation
